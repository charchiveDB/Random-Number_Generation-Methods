---
title: "Midterm Project"
author: "Holden Ellis, Charlotte Huang"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```

# Write Up
https://docs.google.com/document/d/1HZTEfuxbhKEsMSGoFqDvulxrU5hy9rIVp31Wf9el38g/edit?usp=sharing

```{r}
source("Ziggurat.R")
source("BoxMuller.R") # if anyone wants to compare, much faster because of how R runs code
```


```{r}
zigtable(function(x) { exp(-x) }, function(y) { -log(y) },8)
```

```{r}
x <- rnormzig(1000000)
hist(x, freq=FALSE)
curve(dnorm(x), add=TRUE, col="red", lwd=2) # looks good
```
```{r testing}
set.seed(777)

#testing: alpha = 0.01
samples1 <- rnormzig(4999)
print("4999 Samples")

shapiro.test(samples1) # no evidence against normal; p-value > alpha = 0.01
ks.test(samples1, "pnorm", mean=mean(samples1), sd=sd(samples1)) # same

print("1,000,000 ziggurat samples")
# testing 1 mil samples...
ks.test(x, "pnorm", mean=mean(x), sd=sd(x)) # rejected normality
mean(x) # very close to 0
sd(x)   # should be closer to 1

print("1,000,000 rnorm samples")
# additional test:
x2 <- rnorm(1000000)
ks.test(x2, "pnorm", mean=mean(x2), sd=sd(x2)) # passed
mean(x2)  # basically 0
sd(x2)  # 1

# QQ plot
qqnorm(x, pch = 1, frame = FALSE)
qqline(x, col = "steelblue", lwd = 2) # basically normal
```


Assume we generate 100000 with Ziggurat method and they're actually normal, using rnorm() for now

# A chi-squared goodness of fit test (Knuth 1997) is used to check the distribution of the random variables generated. This test quantizes the horizontal axis of the probability density function into k bins and derives a single value as a quality metric from the determined actual and expected number of samples in each bin. 

$\chi^2_{k-1} = \sum^k_{i=1}\frac{(Y_i-tp_i)^2} {tp_i}$

Where t = number of observation, 
$p_i$ = probability that each observation falls into the the category i
$Y_i$ = the number of observation that actually do fall into the category i.  
```{r}
set.seed(999)

n = 100000
samples <- rnorm(n)

chi_squared_test <- function(x, k){
  t <- length(x) # number of observations
  bins <- seq(min(x), 7, length.out = k+1) #200 bins spaced uniformly over data edge of min and max
  
  Yi <- hist(x, breaks = bins, plot = FALSE)$counts # observed counts
  # expected probabilites (p_i) of standard normal
  p_i <- numeric(k)
  for (i in 1:k) {
    p_i[i] <- pnorm(bins[i+1]) - pnorm(bins[i])
}
  # using computing chi square using equation from the paper
  chi_sq <- sum((Yi - t * p_i)^2 / (t * p_i))
  df <- k - 1
  return(data.frame(chi_square = chi_sq,
                    df = df))
}





```

```{r}
set.seed(777)

k <- 200
results <- chi_squared_test(x, k)
kable(results, caption = "Chi-squared value Ziggarut Method") 
```

The critical value for a chi-square test with 199 degrees of freedom at 95% confidence level ($\alpha$ = 0.05) is 232.912. (using a look up table on https://www.medcalc.org/en/manual/chi-square-table.php)

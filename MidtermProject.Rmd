---
title: "Midterm Project"
author: "Holden Ellis, Charlotte Huang"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Write Up
https://docs.google.com/document/d/1HZTEfuxbhKEsMSGoFqDvulxrU5hy9rIVp31Wf9el38g/edit?usp=sharing

```{r}
source("Ziggurat.R")
```


```{r}
n <- 10000
rzigg(NA, 100)
```

```{r}
zigtable(function(x) { exp(-x) }, function(y) { -log(y) },8)
```

```{r}
x <- rnormzig(1000000)
hist(x, freq=FALSE)
curve(dnorm(x), add=TRUE, col="red", lwd=2) # looks good
```
```{r testing}
set.seed(777)

#testing: alpha = 0.01
samples1 <- rnormzig(4999)

shapiro.test(samples1) # no evidence against normal; p-value > alpha = 0.01
ks.test(samples1, "pnorm", mean=mean(samples1), sd=sd(samples1)) # same

# testing 1 mil samples...
ks.test(x, "pnorm", mean=mean(x), sd=sd(x)) # rejected normality
mean(x) # very close to 0
sd(x)   # should be closer to 1

# QQ plot
qqnorm(x, pch = 1, frame = FALSE)
qqline(x, col = "steelblue", lwd = 2) # basically normal
```


Assume we generate 100000 with Ziggurat method and they're actually normal, using rnorm() for now

# A chi-squared goodness of fit test (Knuth 1997) is used to check the distribution of the random variables generated. This test quantizes the horizontal axis of the probability density function into k bins and derives a single value as a quality metric from the determined actual and expected number of samples in each bin. 

$\chi^2_{k-1} = \sum^k_{i=1}\frac{(Y_i-tp_i)^2} {tp_i}$

Where t = number of observation, 
$p_i$ = probabilty that each observation falls into the the category i
$Y_i$ = the number of observation that actually do fall into the category i. The 
```{r}
samples <- rnorm(n)

chi_squared_test <- function(x, bins, pdf){
  t <- length(x)
  k <- length(bins)
  
  Yi <- hist(x, bins = bins, plot = FALSE)$counts
  
  p_i <- numeric(k)
  for(i in 1:k){
    p_i[i] <- integrate(pdf, bins[i], bins[i+1])$value
  }
  
  chi_sq <- sum((Yi - t * p_i)^2 / (t*p_i))
  
}



```


